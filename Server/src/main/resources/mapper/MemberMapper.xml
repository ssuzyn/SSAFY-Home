<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.server.member.mapper.MemberMapper">

	<resultMap id="member" type="com.ssafy.server.member.dto.MemberInfoDto">
		<result column="user_id" property="userId"/>
		<result column="user_name" property="userName"/>
		<result column="user_pwd" property="userPwd"/>
		<result column="email_id" property="emailId"/>
		<result column="email_domain" property="emailDomain"/>
	</resultMap>

	<!-- 로그인 -->
	<select id="login" parameterType="map" resultMap="member">
		select user_id, user_name, token
		from members
		where user_id = #{userId} and user_pwd = #{userPwd}
	</select>

	<!-- 회원 가입 -->
	<insert id="register" parameterType="map">
		INSERT INTO members (user_id, user_name, user_pwd, email_id, email_domain, join_date)
		VALUES (#{userId}, #{userName}, #{userPwd}, #{emailId}, #{emailDomain}, NOW());
	</insert>

	<!-- 회원 정보 조회 -->
	<select id="userInfo" parameterType="string" resultMap="member">
		select user_name, user_id, email_id, email_domain, join_date
		from members
		where user_id = #{userId}
	</select>
	
	<!-- 회원 정보 수정 -->
	<update id="updateUserInfo" parameterType="map">
		UPDATE members
        SET
            user_name = #{userName},
            user_pwd = #{userPwd},
            email_id = #{emailId},
            email_domain = #{emailDomain}
        WHERE
            user_id = #{userId}
	</update>
 	
 	<!-- 프로필 이미지 업데이트 -->
    <update id="updateProfileImage" parameterType="map">
	    UPDATE members
	    SET profile_id = #{fileId}
	    WHERE user_id = #{userId}
	</update>


    <!-- 프로필 이미지 조회 -->
    <select id="findProfileImage" resultType="String">
        SELECT profile_img
        FROM members
        WHERE user_id = #{userId}
    </select>
 	

	<update id="saveRefreshToken" parameterType="map">
		update members
		set token = #{token}
		where user_id = #{userId}
	</update>

	<select id="getRefreshToken" parameterType="string" resultType="string">
		select token
		from members
		where user_id = #{userId}
	</select>

	<update id="deleteRefreshToken" parameterType="map">
		update members
		set token = #{token, jdbcType=VARCHAR}
		where user_id = #{userId}
	</update>

</mapper>