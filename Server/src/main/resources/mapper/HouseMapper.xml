<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.server.house.mapper.HouseMapper">

    <!-- HouseDealResponseDto에 맞는 resultMap 정의 -->
    <resultMap id="HouseDealResponseMap" type="com.ssafy.server.house.dto.HouseDealResponseDto">
        <result property="aptNm" column="apt_nm"/>
        <result property="floor" column="floor"/>
        <result property="excluUseAr" column="exclu_use_ar"/>
        <result property="dealAmount" column="deal_amount"/>
        <result property="dealYear" column="deal_year"/>
        <result property="dealMonth" column="deal_month"/>
        <result property="dealDay" column="deal_day"/>
        <result property="latitude" column="latitude"/>
        <result property="longitude" column="longitude"/>
    </resultMap>

    <!-- 동코드로 아파트 실거래 정보 조회 -->
    <select id="getDealsByDong" parameterType="string" resultMap="HouseDealResponseMap">
        SELECT 
	        hi.apt_nm, 
	        lhd.floor, 
	        lhd.exclu_use_ar,
	        lhd.deal_amount,
	        lhd.deal_year,
	        lhd.deal_month,
	        lhd.deal_day,
	        hi.latitude,
	        hi.longitude
	    FROM 
	        latest_housedeals lhd
	    JOIN 
	        houseinfos hi ON lhd.apt_seq = hi.apt_seq
	    WHERE 
	        hi.dong_code = #{dongCode};
    </select>

    <!-- 특정 아파트 이름으로 실거래 정보 조회 -->
    <select id="getDealsByAptName" parameterType="string" resultMap="HouseDealResponseMap">
        SELECT 
	        hi.apt_nm, 
	        lhd.floor, 
	        lhd.exclu_use_ar,
	        lhd.deal_amount,
	        lhd.deal_year,
	        lhd.deal_month,
	        lhd.deal_day,
	        hi.latitude,
	        hi.longitude
	    FROM 
	        latest_housedeals lhd
	    JOIN 
	        houseinfos hi ON lhd.apt_seq = hi.apt_seq
	    JOIN 
	        dongcodes dc ON hi.umd_nm = dc.dong_name
	    WHERE 
	        hi.apt_nm LIKE CONCAT('%', #{aptName}, '%')
    </select>

	<!-- 특정 아파트 이름으로 실거래 정보 조회 -->
    <select id="getDealsByDongAndAptName" parameterType="string" resultMap="HouseDealResponseMap">
        SELECT 
		    hi.apt_nm, 
		    lhd.floor, 
		    lhd.exclu_use_ar, 
		    lhd.deal_amount, 
		    lhd.deal_year, 
		    lhd.deal_month, 
		    lhd.deal_day, 
		    hi.latitude, 
		    hi.longitude
		FROM 
		    latest_housedeals lhd
		JOIN 
		    houseinfos hi ON lhd.apt_seq = hi.apt_seq
		WHERE 
		    hi.dong_code = #{dongCode}
		    AND hi.apt_nm LIKE CONCAT('%', #{aptName}, '%')
    </select>
	

    <!-- 동코드로 시, 군, 동 정보 조회 -->
    <select id="getAddress" parameterType="string" resultType="string">
        SELECT 
            CONCAT(sido_name, ' ', gugun_name, ' ', dong_name) AS address
        FROM 
            dongcodes
        WHERE 
            dong_code = #{dongCode};
    </select>

</mapper>
